# btest 1 - This test script only works if the curcular buffer routines
# =======   in buffer.c are compiled with CB_SIZE in environ.h set to 64
#

sp_create localhost 16001
sp_listports
sp_open ttyS1
sp_setsep T . T
sp_put Output_string
sp_put Another_line
sp_put A_much_longer_line_containing_junk
sp_put x12345x     # Should fail: buffer full
sp_sleep 7 0       # Wait for it to empty
sp_put x12345x     # Try again: this time it should work
sp_setsep 0 . 0
sp_put finally_an_EOF
sp_query
sp_sleep 0 0       # Wait for the write buffer to empty
sp_close FALSE     # OK - close the connection

pause 1000         # Wait for the connection to become available again

sp_open ttyS1
sp_sleep 200 0
sp_get 200         # Should get:
#                     "Output_string.Another_line."
#                     "A_much_longer_line_containing_junk.x"
#                    This is terminated by a buffer full condition
sp_sleep 40 0
sp_get 40         # Should get "12345x.finally_an_EOF"
sp_sleep 80 0
sp_get 80          # Should get nothing
sp_close TRUE      # Force the close to disconnect
sp_delete

#
# End of test: 1 error expected
#
