# Test 9 - exercise every call sp_echo using a loopback
# ======
#

sp_create localhost 16001
sp_listports
sp_open ttyS4
sp_getport
sp_setport 4800 7 E 1
sp_getport
sp_reset T T T
sp_delay 10
sp_setsep T . T
sp_put Output_string
sp_put Another_line
sp_put A_much_longer_line_containing_junk
sp_put x
sp_setsep 0 . 0
sp_put EOF
sp_query
sp_sleep 0 0                # Wait for the write buffer to empty
sp_setsep T . T
sp_sleep 20 0
sp_get 20                   # Should get "Output_string"
sp_setsep t . f
sp_sleep 20 0
sp_get 20                   # Should get "Another_line."
sp_reset f f T              # Clear the separator
sp_sleep 50 0
sp_get 50                   # Reads "A_much_longer_line_containing_junk.x.EOF"
sp_sleep 0 0
sp_get 80                   # Should get nothing
sp_echo Echoed_message 25 0 # Should get "Echoed_message"
sp_close TRUE               # Force the close to disconnect
sp_delete

#
# End of test: no errors expected
#
